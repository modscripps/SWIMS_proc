% Grid_RunMissingProfs.m -  Insert ungridded CTD data in existing grid; Must supply yearday limits%  for new Down/Up profiles in a matlab data file - Dave W, Nov 2003%%%% Put options, specifications here for now %%%%%%%%%%%%%%%%%%%%%%%%%%%%% profile limits specified in file:ProfByLine = 0; % How to find profile limits: 1=use winchline data; 0=use CTD pr, or otherIgnoreOrder = 1; % Insert missing profiles::% 0=New profiles must follow existing ones (except: replace very last one if incomplete);% 1=To insert missing profiles: Just WARN about yearday-order issues, don't STOP or RESET.%% Edit these values to establish new grid increment or range% Make multiple entries to allow different grid defn's for various yearday rangesZGydays = []; % yearday rangesZGmin = []; ZGint = []; ZGmax = []; % depth-grid start, spacing, endZGrid = []; % depth-grid vectorZGovts = []; % Compute overturn stats flags (0=no, 1=yes)ZGcrz = []; ZGyr = [];% ZGydays(end+1,1:2) = [268.6, 269.1]; % Lk Tests, no pumpZGmin(end+1)=NaN; ZGint(end+1)=NaN; ZGmax(end+1)=NaN;ZGrid{end+1} = []; % Do Not Grid These DataZGovts(end+1) = 0; ZGcrz{end+1} = 'fall03'; ZGyr(end+1)=2003;%ZGydays(end+1,1:2) = [274.7, 275.2]; % Puget Sound TestsZGmin(end+1) = 0; ZGint(end+1) = 0.5; ZGmax(end+1) = 200;ZGrid{end+1} = [ZGmin(end):ZGint(end):ZGmax(end)];ZGovts(end+1) = 1; ZGcrz{end+1} = 'fall03'; ZGyr(end+1)=2003;%ZGydays(end+1,1:2) = [281, 288]; % Lk Wash Tests, quick survey, with pumpZGmin(end+1) = 0; ZGint(end+1) = 0.25; ZGmax(end+1) = 70;ZGrid{end+1} = [ZGmin(end):ZGint(end):ZGmax(end)];ZGovts(end+1) = 1; ZGcrz{end+1} = 'fall03'; ZGyr(end+1)=2003;ZGydays(end+1,1:2) = [297.9, 301.99]; % Hood Canal, 2003ZGmin(end+1) = 0; ZGint(end+1) = 0.5; ZGmax(end+1) = 200;ZGrid{end+1} = [ZGmin(end):ZGint(end):ZGmax(end)];ZGovts(end+1) = 1; ZGcrz{end+1} = 'hc03'; ZGyr(end+1)=2003;ZGydays(end+1,1:2) = [302, 303]; % Adm Inlet, 2003ZGmin(end+1) = 0; ZGint(end+1) = 0.5; ZGmax(end+1) = 250;ZGrid{end+1} = [ZGmin(end):ZGint(end):ZGmax(end)];ZGovts(end+1) = 1; ZGcrz{end+1} = 'hc03'; ZGyr(end+1)=2003;ZGydays(end+1,1:2) = [310, 320]; % Lk Wash M.L. RestratZGmin(end+1) = 0; ZGint(end+1) = 0.25; ZGmax(end+1) = 70;ZGrid{end+1} = [ZGmin(end):ZGint(end):ZGmax(end)];ZGovts(end+1) = 1;  ZGcrz{end+1} = 'ML04'; ZGyr(end+1)=2003;disp('Select file with yearday limits of missing profiles ...')[FilNm,PthNm] = uigetfile('*.mat','Prof_Ydays(1:3,1:nProfs) file');if ~FilNm    disp('None selected, exiting')    returnendRf = fullfile(PthNm,FilNm);clear RDRD=load(Rf); ok=1;if ~isfield(RD, 'Prof_Ydays')    ok=0;elseif size(RD.Prof_Ydays,1)~=3    ok=0;endif ~ok    disp('File does not contain 3-row matrix named Prof_Ydays; exiting')    returnendProf_Ydays = RD.Prof_Ydays;disp('Profile Specifications:  yday_beg; yday_end; down/up(-1/+1)')disp(Prof_Ydays)year = input('Yeardays are for calendar year(yyyy) = ');if isempty(year)    disp('Need 4-digit year, exiting.')    returnend%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Grid profiles, in interval ranges corresponding to CTD matlab filesYLIMS = Prof_Ydays; % [yd_starts; yd_ends; UpDown]if isempty(YLIMS)    return % Data interval had no Down/Up profilesendyd_b = YLIMS(1,1); yd_e = YLIMS(2,end);% Find Grid for this yearday range (yd_b:yd_e cannot stradle grid limits)iG = find( yd_b>=ZGydays(:,1) & yd_b<=ZGydays(:,2) & year==ZGyr');if isempty(iG) | isempty(ZGrid{iG})    disp(['No gridding for ' num2str(year) ' yeardays=' num2str(yd_b) ':' num2str(yd_e)])    returnend%%% Cruise Defn, folders %%%crz=ZGcrz{iG};set_swims_pathscruise=ZGcrz{iG};SWIMSfoldersPCCrName=ZGcrz{iG};IndFld = fullfile(savepath, 'indexes'); % raw,matlab data index folderMatFld = fullfile(savepath,'data_mat','CTD'); % local mat directoryMatIndx = fullfile(IndFld, ['CTD_' CrName '_matfiles.mat']);GridIndx = fullfile(IndFld, ['SWIMS_' CrName '_gridfiles.mat']);GridFld = fullfile(savepath,'griddata'); % local mat directoryGpsIndx = fullfile(IndFld, ['GPS_' CrName '_matfiles.mat']);GpsFld = fullfile(savepath,'data_mat', 'GPS');LinIndx = fullfile(IndFld, ['LD_' CrName '_matfiles.mat']);LinFld = fullfile(savepath,'data_mat', 'LD');%%% Gather indices into Grid,CTD,Line matlab filesclear GrdF CtdF LdF Cruise Set_params Index PROGif ~exist(GridIndx,'file') | ~exist(MatIndx,'file')    disp('  Cannot find index into raw CTD or gridded files, skipping!')    returnelse    GrdF=load(GridIndx);    CtdF=load(MatIndx);endLdF=[];if ProfByLine & ~exist(LinIndx,'file')    disp('  Cannot find index into LineData files (to find profiles), skipping!')    returnelse    LdF=load(LinIndx);endzgrid = ZGrid{iG}; GridOvts = ZGovts(iG);if ~isempty(zgrid)    GridStartTime = yd_b;    yd_b = yd_b - (10/86400); % Just before first profile    yd_e = yd_e + (5/86400); % Just after last profile    GPS = get_gps_data(yd_b, yd_e, GpsIndx, GpsFld, 1);    warning off MATLAB:divideByZero    CSci = get_SWIMS_SciData(yd_b, yd_e, MatIndx, MatFld, 1);    x=input('Press <return> when ready to grid missing profiles:','s');    Grid_MakeNewProfsend    