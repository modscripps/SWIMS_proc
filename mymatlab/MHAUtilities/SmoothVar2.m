function [ydaysm,prsm,varsm]=SmoothVar2(var,pr,yday,firstday,lastday,BinsPerDay,nv,logsm)%function [ydaysm,prsm,varsm]=SmoothVar2(var,pr,yday,firstday,lastday,BinsPerDay,nv,logsm)%Bin-average a gridded variable to a uniform depth-time grid.%The variable should be gridded in depth but may be nonuniformly spaced in time.%Pass in the variable to be smoothed and its pressure grid and time vector.%Also specify integer firstday and lastday.  Lastday is rounded down;%data goes to 298.8, specify lastday = 298.%BinsPerday is the time interval in days.%nv is the number of bins to use in the vertical.%If logsm is one, the logarithm is smoothed instead of arithmetic mean.%default is 0.%%This computes the average in centered bins of the variable.%NaN's are not averaged in.  Output is nv by (lastday-firstday+1)*BinsPerDay.if ~exist('logsm')	logsm=0;end%Now grid data.%firstday=294;%lastday=307;days=lastday-firstday+1;%# of bins to average overvbins=fix(length(pr)/nv);varsm=zeros(nv,BinsPerDay*days)*NaN;for c=1:BinsPerDay*days   DisplayProgress(c,20)   indt=find(yday > firstday+ (c-1)/BinsPerDay & yday <= firstday + c/BinsPerDay);   if isempty(indt)      %no profiles in this time slot      varsm(:,c)=NaN;   else      for d=1:nv			if logsm==0         	tmp=var((d-1)*vbins+1:d*vbins,indt);         else         	tmp=log10(var((d-1)*vbins+1:d*vbins,indt));			end			ind=find(~isnan(tmp));         if isempty(ind)            varsm(d,c)=NaN;         else            if length(ind)==1               varsm(d,c)=tmp(ind);            else               varsm(d,c)=mean(tmp(ind));            end         end               end   endendif logsm==1	varsm=10.^varsm;endfor d=1:nv   prsm(d)=mean(pr((d-1)*vbins+1:d*vbins));endydaysm=firstday+((1:BinsPerDay*days)-0.5)/BinsPerDay;