function [sensorid,spare]=GetSWIMSConfig(ch,year,yday)%function [sensorid,spare]=GetSWIMSConfig(ch,year,yday)%3/01 MHA%Pass in the year and yearday and channel ('t1','t2','c1','c2', or 'pr')%and the serial number of the sensor for that channel is returned (string).%spare is not used at this time. - revised 04/02 dpw (also dox,obs,flu)% 2007 - spare used to indicate swapping of T,C connections for enabling%  pump turn-on in Lk Wash (fresh water)% 2011 - for dif't calib formulae/methodsglobal SWIMS_configif isempty(SWIMS_config)    SWIMSfoldersPCendsensorid = NaN; spare = NaN;dtnum_for = datenum(year,1,1) + yday;%open this file.filename=fullfile(SWIMS_config, ch);fid=fopen(filename,'r');if fid == -1	disp(['Error: no config file exists for channel=' ch])	return;end%Read the first three header lines.line=fgetl(fid); line=fgetl(fid); line=fgetl(fid);done=0;count=1;line=fgetl(fid);while isstr(line)    dstr = [line(6:7) '/' line(9:10) '/' line(1:4) ' ' ...            line(12:13) ':' line(15:16) ':' line(18:19)]; % mm/dd/yyyy hh:mm:ss    dtnum_conf(count) = datenum(dstr);    [dstr,x] = strtok(line);    [a,b] = strtok(x);	sn{count} = a;    [a,b] = strtok(b);    spr{count} = a;	count=count+1;		line=fgetl(fid);endfclose(fid);%Find the last sensor configuration before the desired date.ind = find(dtnum_conf<=dtnum_for);if isempty(ind)    disp(['No config for chan=' ch ' in effect for ' datestr(dtnum_for)])else    [x,im] = max(dtnum_conf(ind)); % don't assume monotonic dates (2011)    if ~strcmp(sn{ind(im)}, '[]')        sensorid = sn{ind(im)};    end    spare = 0;    if ~isempty(spr{ind(im)})        spare = spr{ind(im)};    endend