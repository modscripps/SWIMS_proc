function [a,b,c,d,fo]=read_Tcal_sbe_SWIMS(sn,year,yday)%function [a,b,c,d,fo]=read_Tcal_sbe_SWIMS(sn,year,yday)%Return the temperature cal coefficients for a given S/N, year and yearday.%The function searches the global directory stored in SWIMS_cal/T for%a file whose name is the desired S/N, which contains a list of dates%and coefficients for each calibration.  It reads the last ones before %the desired date and returns them. MHA,2001; rev 4/2002, 12/2011 dpwglobal SWIMS_cal a=NaN;b=NaN;c=NaN;d=NaN;fo=NaN; dtnum_for = datenum(year,1,1) + yday;%open this file.filename=fullfile(SWIMS_cal, 'T' , sn);fid=fopen(filename,'r');if fid == -1	disp(['Error: no cal file exists for Temp S/N=' sn])	return;end%Read the first three header lines.line=fgetl(fid); line=fgetl(fid); line=fgetl(fid);done=0;count=1;line=fgetl(fid);while isstr(line) & length(line)>20    dstr = [line(6:7) '/' line(9:10) '/' line(1:4) ' ' ...            line(12:13) ':' line(15:16) ':' line(18:19)]; % mm/dd/yyyy hh:mm:ss    dtnum_cal(count) = datenum(dstr);    [dstr,x] = strtok(line);	[sa, x] = strtok(x); aa(count)=str2num(sa);	[sb, x] = strtok(x); bb(count)=str2num(sb);	[sc, x] = strtok(x); cc(count)=str2num(sc);	[sd, x] = strtok(x); dd(count)=str2num(sd);	[sf, x] = strtok(x); ff(count)=str2num(sf);	count=count+1;		line=fgetl(fid);endfclose(fid);%Find the last calibration before the desired date.ind = find(dtnum_cal<=dtnum_for);if isempty(ind)    disp(['No calib for S/N=' sn ' in effect for ' datestr(dtnum_for)])else    [x, im] = max(dtnum_cal(ind)); % may not be monotonic (esp. for testing)    ind=ind(im);    a=aa(ind); b=bb(ind); c=cc(ind); d=dd(ind); fo=ff(ind);end