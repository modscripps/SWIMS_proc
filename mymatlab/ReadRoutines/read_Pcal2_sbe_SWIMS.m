function [Pcoefs]=read_Pcal2_sbe_SWIMS(sn,year,yday)%function [Pcoefs]=read_Pcal2_sbe_SWIMS(sn,year,yday)%Return the pressure cal coefficients for a given S/N, year and yearday.%The function searches the global directory stored in SWIMS_cal/P for%a file whose name is the desired S/N, which contains a list of dates%and coefficients for each calibration.  It reads the last ones before %the desired date and returns them in structure Pcoefs.%  MHA, 2001;  Rev 4-2002 dpw, return in structures (add T4,T5,D2).global SWIMS_calPcoefs.C1=NaN;dtnum_for = datenum(year,1,1) + yday;%open this file.filename=fullfile(SWIMS_cal, 'P' , sn);fid=fopen(filename,'r');if fid == -1	disp(['Error: no cal file exists for Pres S/N=' sn])	return;end%Read the first three header lines.line=fgetl(fid); line=fgetl(fid); line=fgetl(fid);done=0; cfs = [];count=1;line=fgetl(fid);while isstr(line)    dstr = [line(6:7) '/' line(9:10) '/' line(1:4) ' ' ...            line(12:13) ':' line(15:16) ':' line(18:19)]; % mm/dd/yyyy hh:mm:ss    dtnum_cal(count) = datenum(dstr);    [dstr,x] = strtok(line);    % There are several, so save coeff sets in rows of cfs(cal#,:)     for i=1:100        [cstr,x] = strtok(x);        cfs(count,i) = str2num(cstr);        % all entries in file must have same number of coeffs        if isempty(deblank(x))            break        end    end	count=count+1;		line=fgetl(fid);endfclose(fid);%Find the last calibration before the desired date.ind = find(dtnum_cal<=dtnum_for);if isempty(ind)    disp(['No calib for S/N=' sn ' in effect for ' datestr(dtnum_for)])else    ind=ind(end);    Pcoefs.C1=cfs(ind,1); Pcoefs.C2=cfs(ind,2); Pcoefs.C3=cfs(ind,3);     Pcoefs.T1=cfs(ind,4); Pcoefs.T2=cfs(ind,5); Pcoefs.T3=cfs(ind,6);    Pcoefs.T4=cfs(ind,7); Pcoefs.T5=cfs(ind,8);    Pcoefs.D1=cfs(ind,9); Pcoefs.D2=cfs(ind,10);     Pcoefs.mo=cfs(ind,11); Pcoefs.yo=cfs(ind,12); end