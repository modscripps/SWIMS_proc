function [PCtimestamp,PCfasttime,LineData] = Read_raw_WinchLine(filename)%function [PCtimestamp,PCfasttime,LineData] = Read_raw_WinchLine(filename, ExErr)%Pass in a filename for winch line data, and return cells of row vectors in% timestamp{1:2} (yeardays), elapsed time{1:2} (seconds),% LineData{1} for line rate (|m/s|,type=A),% and LineData{2} for line out (m, type=B).%The files are ascii.  Dave W - Mar,2002if nargout<3    error('Output to PCtimestamp,PCfasttime,LineData cells is required.')endPCtimestamp{3}=[]; PCfasttime{3}=[]; LineData{3}=[]; %extra for unknownsHrPday=24; MinPday=1440; SecPday=86400;  year = 0;[fid,message]=fopen(filename,'r');% Field positionsLmin = 42; % minimum record lengthfpos = [1,1; 5,11];DSoff = 31; % length of prefixed date/time stampsRoff = 0; % length of anything before d/t stampsfpos = fpos + DSoff+Roff; % Process valid records line=fgetl(fid);counter(1:3)=0;while ischar(line)    if length(line)>=Lmin  % valid record length        ip=1;  % Read record_type first, to determine cell index        typ = line(fpos(ip,1):fpos(ip,2));        switch typ        case 'A'            icell=1; % line rate        case 'B'            icell=2; % line out        otherwise            icell=3; % odd balls        end        counter(icell)=counter(icell)+1;        year=str2num(line(Roff+1:Roff+4));        yday0=str2num(line(Roff+5:Roff+7)); % yearday (Jan 1 = 0.nnnn)        hour=str2num(line(Roff+8:Roff+9));        min=str2num(line(Roff+10:Roff+11));        sec=str2num(line(Roff+12:Roff+13));        ydx = yday0 + hour/HrPday + min/MinPday + sec/SecPday;        PCtimestamp{icell} = [PCtimestamp{icell} ydx];        %Elapsed time next.        tmp=line(Roff+15:Roff+30); iord=[15 16 13 14 11 12 9 10 7 8 5 6 3 4 1 2];        PCfasttime{icell} = [PCfasttime{icell}  hex2num(tmp(iord))];                % Line data        ip = 2;        x = str2num( line(fpos(ip,1):fpos(ip,2)) );        if isempty(x), x=NaN; end        LineData{icell} = [LineData{icell}  x];    end % of valid winch line record    %Get the next line    line=fgetl(fid);endif counter(3)<1 % No unexpected 'types'    PCtimestamp(3)=[]; PCfasttime(3)=[]; LineData(3)=[];end% Kluge for buffer latency in mc09:if year == 2009    for i=1:length(PCtimestamp)        x = PCtimestamp{i};        ix = find(x>=95.2216 & x<=95.553);        x(ix) = x(ix) - 22/86400; % recorded 22 sec late        PCtimestamp{i} = x;    endendLineData{1} = LineData{1} / 60; % m/min  to  m/sec% LineData{2} is in metersfclose(fid);